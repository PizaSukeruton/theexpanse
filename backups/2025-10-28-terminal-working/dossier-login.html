<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>C_O_T_W Dossier System â€” Council Of The Wise</title>
  <style>
    :root {
      --bg: #000000;
      --accent: #00ff75;        /* unified neon */
      --fg: #00ff75;
      --shadow: 0 0 24px rgba(0,255,0,0.25), 0 0 64px rgba(0,255,0,0.1);
      --radius: 16px;
      --gap: 16px;
    }
    html, body { height: 100%; }
    body {
      margin: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: "Courier New", "IBM Plex Mono", ui-monospace, monospace;
      letter-spacing: 0.2px;
      overflow: hidden;
    }

    .crt { position: relative; filter: contrast(1.05) saturate(1.1); text-shadow: 0 0 1px rgba(0,255,0,0.45), 0 0 8px rgba(0,255,0,0.12); }
    .crt::after { content:""; pointer-events:none; position:absolute; inset:0;
      background: repeating-linear-gradient(to bottom, rgba(0,255,0,0.06) 0 2px, transparent 2px 4px);
      mix-blend-mode: screen;
    }

    .app { display:grid; grid-template-columns:1fr 1.1fr; gap:var(--gap); height:100vh; padding:16px; box-sizing:border-box; }

    .panel {
      border: 1px solid var(--accent);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      background: rgba(0,32,0,0.28);
      position: relative;
      overflow: hidden;
    }

    /* Left stack */
    .left-panel { display:grid; grid-template-rows:auto 1fr auto; gap:12px; }
    .dossier-stack { display:grid; grid-template-rows:auto auto; gap:12px; position:relative; }

    .panel-box { position: relative; border: 1px solid var(--accent); border-radius: 12px; padding: 0; box-shadow: var(--shadow); background: rgba(0,16,0,0.25); }
    .portrait-wrap { height: 220px; }
    .portrait { width: 100%; height:100%; object-fit: contain; object-position: center 30%; border-radius: 12px; filter: grayscale(20%) contrast(1.05); }

    .info-box { padding:12px; }
    .info-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 8px 16px; }
    .info-k {}
    .info-v { font-weight: bold; }
    .summary { margin-top: 10px; }

    .notes-box { border:1px solid var(--accent); border-radius:12px; padding:12px; background: rgba(0,16,0,0.25); box-shadow: var(--shadow); }
    .notes-box textarea { width:100%; min-height:120px; resize:vertical; background:transparent; border:none; outline:none; color:var(--fg); font:inherit; line-height:1.35; }

    /* Right/chat */
    .right-panel { display:grid; grid-template-rows:auto 1fr auto; gap:12px; }
    .hud { /* keep in flow to avoid overlay issues */ position: static; padding:10px 14px; border:1px solid var(--accent); border-radius:12px; background: rgba(0,255,0,0.04); font-weight:600; }
    .hud small { font-weight:400; opacity:1; }

    .chat-log { border:1px solid var(--accent); border-radius:12px; padding:12px; background: rgba(0,16,0,0.25); box-shadow: var(--shadow); overflow-y:auto; padding-bottom:32px; }
    .line { white-space: pre-wrap; word-break: break-word; margin: 6px 0; }
    .line .tag { margin-right: 6px; }
    .line.granted { font-weight: bold; }

    .chat-input-bar { display:grid; grid-template-columns: 1fr auto; gap:8px; align-items:center; }
    input[type="text"], input[type="password"] {
      background: rgba(0,16,0,0.25); border:1px solid var(--accent); border-radius:12px; outline:none; color:var(--fg); padding:12px 14px; font:inherit; box-shadow: var(--shadow);
    }
    button { background:transparent; border:1px solid var(--accent); color:var(--fg); padding:10px 14px; border-radius:12px; font:inherit; cursor:pointer; box-shadow:var(--shadow); transition: transform 80ms ease, background 120ms ease; }
    button:hover { transform: translateY(-1px); background: rgba(0,255,0,0.06); }

    .blink-caret { display:inline-block; width:10px; height:1.2em; background:var(--fg); animation: blink 1s steps(2,start) infinite; vertical-align:baseline; }
    @keyframes blink { 0%{opacity:0} 50%{opacity:1} 100%{opacity:0} }

    /* FULL dossier cover (stronger shading) */
    .dossier-cover {
      position:absolute; inset:16px; /* respect panel padding */
      display:grid; place-items:center;
      pointer-events:auto;
      background:
        linear-gradient(180deg, rgba(0,14,0,0.98), rgba(0,0,0,1)),
        radial-gradient(90% 60% at 50% 35%, rgba(0,255,0,0.10), transparent 60%);
      border:2px solid var(--accent);
      border-radius:12px;
      box-shadow:
        0 0 22px rgba(0,255,117,0.28),
        inset 0 0 18px rgba(0,255,117,0.18);
      transform: translateY(0);
      transition: transform .7s ease-in-out;
      z-index: 9;
    }
    .dossier-cover::before {
      content:"";
      position:absolute; inset:0;
      background:
        repeating-linear-gradient(to bottom, rgba(0,255,0,0.18) 0 2px, rgba(0,0,0,0.0) 2px 4px),
        linear-gradient(180deg, rgba(0,255,0,0.10), rgba(0,0,0,0) 35%, rgba(0,0,0,0.35) 85%, rgba(0,0,0,0.9) 100%);
      mix-blend-mode: screen;
      border-radius:12px;
      pointer-events:none;
    }
    .dossier-cover.open { transform: translateY(-104%); pointer-events:none; }

    .cover-inner { text-align:center; padding: 28px 18px; }
    .cover-title { font-weight: 900; font-size: 28px; letter-spacing: 2px; }
    .cover-sub   { margin-top: 8px;  font-weight: 800; font-size: 18px; }
    .cover-instr { margin-top: 20px; font-weight: 800; font-size: 14px; line-height: 1.5; }

    @media (max-width: 1000px) {
      .app { grid-template-columns:1fr; overflow-y:auto; height:auto; min-height:100vh; }
      body { overflow:auto; }
    }
    @media (max-width: 480px) {
      .panel { padding:12px; }
      .dossier-cover { inset:12px; }
      .portrait-wrap { height:180px; }
      input, button { font-size:14px; }
      .cover-title { font-size:22px; }
    }
  </style>
</head>
<body>
  <div class="app crt" id="app">

    <!-- LEFT: DOSSIER -->
    <section class="panel left-panel" id="dossier-panel" aria-live="polite">
      <div class="dossier-stack">
        <!-- Portrait -->
        <div class="panel-box portrait-wrap">
          <img src="/gallery/pizasukerutonprofile.png" alt="Agent Portrait" class="portrait" id="agent-portrait" />
        </div>

        <!-- Fields -->
        <div class="panel-box">
          <div class="info-box">
            <div class="info-grid">
              <div class="info-k">NAME</div><div class="info-v" id="f-name"></div>
              <div class="info-k">ENTITY</div><div class="info-v" id="f-entity"></div>
              <div class="info-k">DEPARTMENT</div><div class="info-v" id="f-dept"></div>
              <div class="info-k">SECURITY LEVEL</div><div class="info-v" id="f-sec"></div>
            </div>
            <div class="summary" id="summary">Summary:</div>
          </div>
        </div>
      </div>

      <!-- Single full dossier cover -->
      <div id="dossier-cover" class="dossier-cover" aria-hidden="false">
        <div class="cover-inner">
          <div class="cover-title">COUNCIL OF THE WISE</div>
          <div class="cover-sub">EYES ONLY</div>
          <div class="cover-instr">AUTHENTICATE CREDENTIALS<br>TO ACCESS</div>
        </div>
      </div>
    </section>

    <!-- RIGHT: TERMINAL -->
    <section class="panel right-panel" id="chat-panel">
      <div class="hud">TERMINAL :: CHAT <small>AUTH + COMMAND</small></div>
      <div class="chat-log" id="chat-log" role="log" aria-live="polite"></div>
      <div class="chat-input-bar">
        <input type="text" name="decoy-user" autocomplete="username" tabindex="-1" style="position:absolute;left:-9999px;width:1px;height:1px;" /><input type="password" name="decoy-pass" autocomplete="current-password" tabindex="-1" style="position:absolute;left:-9999px;width:1px;height:1px;" /><input id="chat-input" name="terminal-entry" autocomplete="off" readonly type="text" placeholder="> Enter username" autocomplete="off" data-lpignore="true" data-bwignore="true" data-1p-ignore="true" data-lpignore="true" data-bwignore="true" data-1p-ignore="true" />
        <button id="send-btn" type="button">Send</button>
      </div>
    </section>

  </div>

</body>
</html>
<!-- Simple Gallery Section -->
<div id="gallery">
  <img src="/gallery/pizasukerutonprofile.png" alt="" style="max-width: 100%; margin: 10px; border-radius: 8px;">
</div>
<div id="gallery" style="margin-top: 20px;">
  <img src="/gallery/pizasukerutonprofile.png" alt=" Profile" style="max-width: 300px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,255,117,0.3);">
  input.setAttribute('autocomplete', 'off');
  
  // Toggle input type to prevent autofill detection
  input.addEventListener('focus', function() {
    if (input.type === 'text') {
      input.type = 'password';
    }
  });
  
  input.addEventListener('blur', function() {
    // Briefly switch to text to confuse password manager (then back)
    if (input.type === 'password') {
      input.type = 'text';
      setTimeout(() => {
        if (input.type === 'text') {
          input.type = 'password';
        }
      }, 50);
    }
  });
});
</script>
<style>
/* Dynamic portrait sizing - responsive to image dimensions */
.portrait-wrap {
  height: auto; /* Remove fixed height */
  min-height: 180px; /* Minimum for empty states */
  max-height: 300px; /* Cap for very tall images */
  width: 100%;
  overflow: hidden;
  border-radius: 12px;
  position: relative;
}

.portrait {
  width: 100%;
  height: 100%;
  object-fit: contain; object-position: center 30%; /* Scales image to fill container while preserving aspect ratio, crops if needed */
  object-position: center; /* Centers the image focus */
  display: block;
  transition: transform 0.3s ease, filter 0.3s ease; /* Smooth loading/zoom */
}

.portrait:hover {
  transform: scale(1.05); /* Subtle zoom on hover */
  filter: grayscale(0%) contrast(1.1); /* Enhance on interaction */
}

/* Adjust left panel to flex with portrait */
.left-panel {
  display: grid;
  grid-template-rows: auto 1fr auto;
  gap: 12px;
  min-height: 0; /* Allow shrinking */
}

.dossier-stack {
  display: grid;
  grid-template-rows: auto auto; /* Let portrait determine first row height */
  gap: 12px;
}

/* Responsive breakpoints for mobile */
@media (max-width: 1000px) {
  .portrait-wrap {
    min-height: 150px;
    max-height: 250px;
  }
}

@media (max-width: 480px) {
  .portrait-wrap {
    min-height: 120px;
    max-height: 200px;
  }
}
</style>


<script>
const input = document.getElementById('chat-input');
const button = document.getElementById('send-btn');
const chatLog = document.getElementById('chat-log');
const cover = document.getElementById('dossier-cover');

const DEMO_USER = "pizasukeruton";
const DEMO_PASS = "ctw-secret";
let loginState = "username";

function addLine(text, cls = "") {
  const line = document.createElement('div');
  line.className = 'line ' + cls;
  line.textContent = text;
  chatLog.appendChild(line);
  chatLog.scrollTop = chatLog.scrollHeight;
}

function handleUsername(value) {
  if (loginState === "username") {
    addLine("> " + value);
    if (value === DEMO_USER) {
      loginState = "password";
      input.type = "password";
      input.placeholder = "> Enter password";
      input.value = "";
    } else {
      addLine("SYSTEM: Unknown user", "error");
      input.value = "";
    }
  } else if (loginState === "password") {
    addLine("> ********");
    if (value === DEMO_PASS) {
      addLine("SYSTEM: ACCESS GRANTED", "granted");
      loginState = "command";
      input.type = "text";
      input.placeholder = "> Enter command";
      input.value = "";
    } else {
      addLine("SYSTEM: ACCESS DENIED", "error");
      loginState = "username";
      input.type = "text";
      input.placeholder = "> Enter username";
      input.value = "";
    }
  } else if (loginState === "command") {
    addLine("> " + value);
    handleCommand(value);
    input.value = "";
  }
}

function handleCommand(cmd) {
  const lower = cmd.toLowerCase().trim();
  if (lower.startsWith("who is")) {
    const name = lower.replace("who is", "").trim().replace(/\?/g, "");
    if (name === "piza sukeruton") {
      addLine("SYSTEM: Opening dossier for " + name + "...");
      cover.classList.add('open');
      populateDossier();
    } else {
      addLine("SYSTEM: No record found for " + name);
    }
  } else {
    addLine("SYSTEM: Unknown command");
  }
}

function populateDossier() {
  document.getElementById('f-name').textContent = '';
  document.getElementById('f-entity').textContent = '';
  document.getElementById('f-dept').textContent = '';
  document.getElementById('f-sec').textContent = '';
  document.getElementById('summary').textContent = 'Summary: ';
}

function submitInput() {
  const val = input.value.trim();
  if (val) handleUsername(val);
}

input.addEventListener('keydown', (e) => { if (e.key === 'Enter') submitInput(); });
button.addEventListener('click', submitInput);
</script>
</body>
</html>
<script>
(function(){
  const inp = document.getElementById('chat-input');
  if (!inp) return;
  inp.name = 'term-' + Math.random().toString(36).slice(2,8);
  function unlock() {
    setTimeout(() => inp.removeAttribute('readonly'), 50);
    inp.removeEventListener('focus', unlock);
  }
  inp.addEventListener('focus', unlock);
})();
</script>

<script>
async function sendChatMessage() {
  const input = document.getElementById('chat-input');
  const message = input.value.trim();
  
  if (!message) return;
  
  const outputDiv = document.querySelector('.terminal-output') || document.body;
  const userMsg = document.createElement('div');
  userMsg.style.color = '#00ff00';
  userMsg.textContent = '> ' + message;
  outputDiv.appendChild(userMsg);
  
  input.value = '';
  
  try {
    const response = await fetch('/api/expanse/council/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message })
    });
    
    const data = await response.json();
    
    const botMsg = document.createElement('div');
    botMsg.style.color = '#ffaa00';
    botMsg.style.marginTop = '10px';
    botMsg.textContent = data.text || 'No response';
    outputDiv.appendChild(botMsg);
    
  } catch (error) {
    console.error('Chat error:', error);
    const errorMsg = document.createElement('div');
    errorMsg.style.color = '#ff0000';
    errorMsg.textContent = 'ERROR: Could not connect to Council';
    outputDiv.appendChild(errorMsg);
  }
}

document.getElementById('chat-input').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') sendChatMessage();
});
</script>
# EOF Patch: Update  Dossier Details
sed -i '' \
  -e "s|<div class=\"info-k\">ENTITY</div><div class=\"info-v\">.*</div>|<div class=\"info-k\">ENTITY</div><div class=\"info-v\">Multiverse Reaper</div>|" \
  -e "s|<div class=\"info-k\">DEPARTMENT</div><div class=\"info-v\">.*</div>|<div class=\"info-k\">DEPARTMENT</div><div class=\"info-v\">Expanse Team</div>|" \
  -e "s|<div class=\"info-k\">SECURITY LEVEL</div><div class=\"info-v\" id=\"sec-level\">.*</div>|<div class=\"info-k\">SECURITY LEVEL</div><div class=\"info-v\" id=\"sec-level\">Level 0 - Use Extreme Caution</div>|" \
  public/dossier-login.html
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('f-entity').textContent = 'Multiverse Reaper';
  document.getElementById('f-dept').textContent = 'Expanse Team';
  document.getElementById('f-sec').textContent = 'Level 0 - Use Extreme Caution';
});
</script>
<script>
// Typing animation for dossier fields
function typeText(elementId, text, delay = 50) {
  const elem = document.getElementById(elementId);
  elem.textContent = '';
  let index = 0;
  
  function addChar() {
    if (index < text.length) {
      elem.textContent += text[index];
      index++;
      setTimeout(addChar, delay);
    }
  }
  addChar();
}

function populateDossier() {
  setTimeout(() => typeText('f-name', 'Piza Sukeruton', 60), 100);
  setTimeout(() => typeText('f-entity', 'Multiverse Reaper', 60), 500);
  setTimeout(() => typeText('f-dept', 'Expanse Research Team', 60), 900);
  setTimeout(() => typeText('f-sec', 'Unknown', 60), 1400);
  setTimeout(() => typeText('summary', 'Summary: [CLASSIFIED]', 60), 1800);
}
</script>
<script>
// Typing animation for dossier fields
function typeText(elementId, text, delay = 50) {
  const elem = document.getElementById(elementId);
  elem.textContent = '';
  let index = 0;
  
  function addChar() {
    if (index < text.length) {
      elem.textContent += text[index];
      index++;
      setTimeout(addChar, delay);
    }
  }
  addChar();
}

function populateDossier() {
  setTimeout(() => typeText('f-name', 'Piza Sukeruton', 60), 100);
  setTimeout(() => typeText('f-entity', 'Multiverse Reaper', 60), 500);
  setTimeout(() => typeText('f-dept', 'Expanse Research Team', 60), 900);
  setTimeout(() => typeText('f-sec', 'Unknown', 60), 1400);
  setTimeout(() => typeText('summary', 'Summary: [CLASSIFIED]', 60), 1800);
}
</script>
<script>
// Enhanced chat handler that connects to your tmbot3000 backend
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById('chat-input');
  const chatLog = document.getElementById('chat-log');
  let authenticated = false;

  async function sendToBot(message) {
    // Add user message to chat log
    const userLine = document.createElement('div');
    userLine.className = 'line';
    userLine.innerHTML = '<span class="tag">[USER]</span>' + message;
    chatLog.appendChild(userLine);
    
    try {
      // Send to your tmbot3000 API endpoint
      const response = await fetch('/api/tmbot/chat', {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ 
          message: message,
          userId: 'dossier-user',
          context: 'expanse'
        })
      });

      if (!response.ok) throw new Error('API error');
      
      const data = await response.json();
      
      // Add bot response to chat log
      const botLine = document.createElement('div');
      botLine.className = 'line granted';
      botLine.innerHTML = '<span class="tag">[SYSTEM]</span>' + (data.response || data.text || 'No response');
      chatLog.appendChild(botLine);
      
    } catch (error) {
      console.error('Chat error:', error);
      const errorLine = document.createElement('div');
      errorLine.className = 'line error';
      errorLine.innerHTML = '<span class="tag">[ERROR]</span>Failed to connect to Council';
      chatLog.appendChild(errorLine);
    }
    
    chatLog.scrollTop = chatLog.scrollHeight;
  }

  // Override the command handler to enable chat after "who is" command
  window.handleCommand = function(cmd) {
    const lower = cmd.toLowerCase().trim();
    if (lower.startsWith("who is")) {
      const name = lower.replace("who is", "").trim().replace(/\?/g, "");
      if (name === "piza sukeruton") {
        addLine("SYSTEM: Opening dossier for " + name + "...");
        cover.classList.add('open');
        populateDossier();
        
        // Enable chat mode after dossier opens
        setTimeout(() => {
          authenticated = true;
          input.placeholder = "> Chat with Council";
          addLine("SYSTEM: Secure channel established. You may now communicate.");
        }, 2500);
      } else {
        addLine("SYSTEM: No record found for " + name);
      }
    } else if (authenticated) {
      // Send regular chat messages to bot
      sendToBot(cmd);
    } else {
      addLine("SYSTEM: Authentication required. Use 'who is [name]' first.");
    }
  };
});
</script>
<script>
// Override the existing handleCommand to enable chat after dossier opens
(function() {
  let chatEnabled = false;
  const originalHandleCommand = window.handleCommand;
  
  window.handleCommand = async function(cmd) {
    const lower = cmd.toLowerCase().trim();
    
    if (lower.startsWith("who is")) {
      const name = lower.replace("who is", "").trim().replace(/\?/g, "");
      if (name === "piza sukeruton") {
        addLine("SYSTEM: Opening dossier for " + name + "...");
        document.getElementById('dossier-cover').classList.add('open');
        populateDossier();
        
        // Enable chat mode after dossier opens
        setTimeout(() => {
          chatEnabled = true;
          document.getElementById('chat-input').placeholder = "> Chat with Council";
          addLine("SYSTEM: Secure channel established. You may now communicate.");
        }, 2500);
      }
    } else if (chatEnabled) {
      // Send to backend API
      try {
        const response = await fetch('/api/tmbot/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ 
            message: cmd, 
            userId: 'agent-001',
            context: 'expanse' 
          })
        });
        
        const data = await response.json();
        addLine("COUNCIL: " + data.response);
      } catch (err) {
        addLine("ERROR: Connection lost");
      }
    } else {
      addLine("SYSTEM: Authenticate first with 'who is piza sukeruton'");
    }
  };
})();
</script>
<script src="terminal-integration.js"></script>
<script src="terminal-fix.js"></script>
