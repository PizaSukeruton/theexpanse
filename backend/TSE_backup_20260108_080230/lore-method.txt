
  async teachLore(characterId, query) {
    try {
      if (!this.learningDB || !this.learningDB.pool) {
        console.warn("[TeacherComponent] No learningDB for lore teaching");
        return null;
      }

      const loreItems = await this.learningDB.pool.query(`
        SELECT knowledge_id, entity_name, description
        FROM lore_knowledge_graph
        ORDER BY RANDOM()
        LIMIT 3
      `);

      if (loreItems.rows.length === 0) {
        console.warn("[TeacherComponent] No lore items available");
        return null;
      }

      const item = loreItems.rows[0];
      const taskId = await generateHexId("tse_task_id");

      const taskTypes = [
        {
          type: "lore_character_question",
          instructions: "Answer a question about " + item.entity_name + " from the Piza Sukeruton Multiverse.",
          input: "Who is " + item.entity_name + " and what is their role?",
          expectedFormat: "A clear answer describing their character and significance."
        },
        {
          type: "lore_category_identify",
          instructions: "Identify the category/type of " + item.entity_name,
          input: "What type of character is " + item.entity_name + "?",
          expectedFormat: "The character category with a brief explanation."
        }
      ];

      const chosen = taskTypes[Math.floor(Math.random() * taskTypes.length)];

      return {
        taskId,
        taskType: chosen.type,
        instructions: chosen.instructions,
        input: chosen.input,
        expectedFormat: chosen.expectedFormat,
        difficulty: 1,
        characterId,
        knowledgeId: item.knowledge_id,
        metadata: {
          teacherNode: this.nodeId,
          difficulty: 1,
          loreEntity: item.entity_name,
          context: { sessionStep: 1 }
        }
      };
    } catch (e) {
      console.error("[TeacherComponent] teachLore error:", e.message);
      return null;
    }
  }
